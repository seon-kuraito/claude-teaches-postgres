# 檔案操作指南

本文件說明檔案命名規範與覆寫規則。所有角色在產出檔案前都應遵循這些規則。

---

## 檔案命名規範

### 章節編號
- 統一使用**兩位數**：`01`, `02`, ..., `99`
- 即使只有少於 10 章，仍使用 `01` 而非 `1`

### 日期格式
- 統一使用 `YYYYMMDD` 格式
- 範例：`20241216`（2024 年 12 月 16 日）

### 檔名規則

| 檔案類型 | 命名格式 | 範例 |
|---------|---------|------|
| 章節規劃 | `XX-章節名稱.md` | `01-認識資料庫.md` |
| 教學內容 | `XX-章節名稱.md` | `01-認識資料庫.md` |
| 測驗題目 | `XX-章節名稱-exam.md` | `01-認識資料庫-exam.md` |
| 答案檔案 | `XX-章節名稱-answer.md` | `01-認識資料庫-answer.md` |
| 批改記錄 | `XX-章節名稱-YYYYMMDD.md` | `01-認識資料庫-20241216.md` |

### 字元規範
- 使用繁體中文命名（符合專案語言）
- 避免特殊字元（`/`, `\`, `:`, `*`, `?`, `"`, `<`, `>`, `|`）
- 空格以 `-` 分隔（若需要）

---

## 檔案覆寫規則

各目錄的檔案覆寫處理方式：

| 目錄 | 檔案類型 | 覆寫規則 |
|------|---------|---------|
| `curriculum/` | 課程大綱 | 覆寫前詢問使用者確認 |
| `chapters/` | 教學內容 | 覆寫前詢問使用者確認 |
| `exams/` | 測驗題目 | 覆寫前詢問使用者確認 |
| `exams/` | 答案檔案 | **不可覆寫** (見下方特殊處理) |
| `feedback/` | 批改記錄 | **永不覆寫** (用日期區分版本) |
| `學習進度.md` | 進度追蹤 | 自動更新（增量修改） |

---

## 特殊處理：Answer 檔案

答案檔案（`XX-章節名稱-answer.md`）由學習者手動填寫，需特別小心處理。

### `/examiner` 執行時的處理流程

```
1. 檢查 answer.md 是否存在
   ↓
2. 若不存在 → 直接產出空白模板
   ↓
3. 若已存在 → 詢問使用者：

   選項 1: 保留現有答案檔（不產出新檔案）
   選項 2: 備份後產出新模板(將舊檔案重新命名為 XX-章節名稱-answer-backup-YYYYMMDD.md)
   選項 3: 取消操作
```

### 警告訊息範例

```
⚠️  警告：答案檔案已存在

檔案: docs/exams/01-認識資料庫-answer.md

若覆寫此檔案，學習者已填寫的答案將會遺失。建議選擇：

1. 保留現有答案檔（建議）
2. 備份後產出新模板
3. 取消操作

請選擇 (1/2/3):
```

---

## Feedback 版本控制

批改記錄使用日期作為版本區分，永不覆寫。

### 同一章節多次批改範例

```
docs/feedback/
├── 01-認識資料庫-20241215.md  # 第一次批改
├── 01-認識資料庫-20241220.md  # 複習後重測
└── 01-認識資料庫-20241225.md  # 再次重測
```

### `/grader` 產出檔案流程

```
1. 取得當前日期（YYYYMMDD）
2. 組合檔名：XX-章節名稱-YYYYMMDD.md
3. 直接產出（不檢查是否存在，因為日期應該不同）
```

---

## 學習進度.md 更新規則

`學習進度.md` 是增量更新，不是完整覆寫。

### 更新時機

| 角色 | 更新內容 |
|------|---------|
| `/planner` | 建立初始版本（若不存在） |
| `/teacher` | 標記章節「教學完成 ✅」，更新完成日期 |
| `/grader` | 更新測驗狀態、成績、平均成績、學習天數 |

### 更新方式
- 使用 Edit tool 精確修改對應欄位
- 不要整個檔案重寫
- 保留其他章節的資料不變

### 範例：`/teacher` 完成後的更新

```markdown
# 更新前
| 01 | 認識資料庫 | - | - | - | - |

# 更新後
| 01 | 認識資料庫 | ✅ | - | - | 2024-12-16 |
```

---

## 檔案操作檢查清單

執行任何檔案產出前，請確認：

- [ ] 檔名格式正確（章節編號、日期格式）
- [ ] 檢查目標檔案是否已存在
- [ ] 根據覆寫規則決定處理方式
- [ ] 若需詢問使用者，提供清楚的選項
- [ ] 產出後驗證檔案內容格式正確
